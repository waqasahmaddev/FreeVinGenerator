let allowedChars="ABCDEFGHJKLMNPRSTUVWXYZ0123456789";function transliterate(e){return{A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9}[e]||0}let weights=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];function calculateCheckDigit(t){let n=0;for(let e=0;e<17;e++)n+=transliterate(t[e])*weights[e];var e=n%11;return 10===e?"X":e.toString()}function generateVIN(){var t=[];for(let e=0;e<17;e++)t.push(allowedChars[Math.floor(Math.random()*allowedChars.length)]);t[8]=calculateCheckDigit(t);var e=t.join(""),n=document.getElementById("vin");n&&(n.value=e),gtag("event","vin_generated",{event_category:"Tool Usage",event_label:"Random VIN",value:1})}let notificationTimeout;function copyVIN(){var t=document.getElementById("vin");if(t){t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value);let e=document.getElementById("notification");e&&(clearTimeout(notificationTimeout),e.classList.remove("show"),setTimeout(()=>{e.classList.add("show")},10),notificationTimeout=setTimeout(()=>{e.classList.remove("show")},2500))}}function toggleTheme(){var e=document.documentElement,t=document.body,e=e.classList.toggle("dark-mode");t.classList.toggle("dark-mode"),localStorage.setItem("theme",e?"dark":"light")}function loadTheme(){"dark"===localStorage.getItem("theme")&&document.body.classList.add("dark-mode")}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function handleScroll(){var e=document.querySelector(".scroll-to-top");e&&(300<window.pageYOffset?e.classList.add("visible"):e.classList.remove("visible"))}function toggleMobileMenu(){var e=document.getElementById("mainNav"),t=document.querySelector(".mobile-menu-toggle"),n=document.body;e.classList.toggle("active"),t.classList.toggle("active"),n.classList.toggle("menu-open")}function smoothScrollToContent(){var e,t=document.querySelector(".content-section");t&&(e=document.querySelector("header").offsetHeight,t=t.offsetTop-e-20,window.scrollTo({top:t,behavior:"smooth"}))}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("currentYear"),e=(e&&(e.textContent=(new Date).getFullYear()),document.getElementById("vin")),e=(e&&generateVIN(),localStorage.getItem("theme"));"dark"===e&&document.body.classList.add("dark-mode"),window.addEventListener("scroll",handleScroll)}),document.addEventListener("click",function(e){var t,n=document.getElementById("mainNav"),o=document.querySelector(".mobile-menu-toggle"),a=document.body,i=document.getElementById("menuOverlay");n&&o&&n.classList.contains("active")&&(t=n.contains(e.target),e=o.contains(e.target),t||e||(n.classList.remove("active"),o.classList.remove("active"),a.classList.remove("menu-open"),i&&i.classList.remove("active")))}),document.addEventListener("DOMContentLoaded",function(){let o=document.getElementById("menuOverlay");o&&o.addEventListener("click",function(){var e=document.getElementById("mainNav"),t=document.querySelector(".mobile-menu-toggle"),n=document.body;e&&t&&(e.classList.remove("active"),t.classList.remove("active"),n.classList.remove("menu-open"),o.classList.remove("active"))});var e=document.querySelectorAll("#mainNav a");let a=document.body;e.forEach(e=>{e.addEventListener("click",function(){var e=document.getElementById("mainNav"),t=document.querySelector(".mobile-menu-toggle"),n=document.getElementById("menuOverlay");e&&t&&e.classList.contains("active")&&(e.classList.remove("active"),t.classList.remove("active"),a.classList.remove("menu-open"),n)&&n.classList.remove("active")})})});let allowedCharsBulk="ABCDEFGHJKLMNPRSTUVWXYZ0123456789",generatedVINs=[];function transliterateBulk(e){return{A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9}[e]||0}function calculateCheckDigitBulk(t){var n=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let o=0;for(let e=0;e<17;e++)o+=transliterateBulk(t[e])*n[e];var e=o%11;return 10===e?"X":e.toString()}function generateSingleVIN(){var t=[];for(let e=0;e<17;e++)t.push(allowedCharsBulk[Math.floor(Math.random()*allowedCharsBulk.length)]);return t[8]=calculateCheckDigitBulk(t),t.join("")}function generateBulkVINs(){var e=document.getElementById("vinCount");let t=parseInt(e.value);isNaN(t)||t<1?(t=1,e.value=1):1e3<t&&(t=1e3,e.value=1e3),generatedVINs=[];for(let e=0;e<t;e++)generatedVINs.push(generateSingleVIN());document.getElementById("vinsOutput").value=generatedVINs.join("\n"),document.getElementById("bulkOutput").style.display="block",document.getElementById("copyBtn").style.display="flex",document.getElementById("downloadBtns").style.display="flex",showNotification(`Generated ${t} VIN${1<t?"s":""} successfully!`),gtag("event","bulk_vin_generated",{event_category:"Tool Usage",event_label:"Bulk Generator",value:t})}function copyAllVINs(){var e=document.getElementById("vinsOutput");e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value),showNotification("All VINs copied to clipboard!")}function downloadVINs(e){let t="",n="",o="";"txt"===e?(t=generatedVINs.join("\n"),n="vins.txt",o="text/plain"):"csv"===e&&(t="VIN\n"+generatedVINs.join("\n"),n="vins.csv",o="text/csv");var e=new Blob([t],{type:o}),e=window.URL.createObjectURL(e),a=document.createElement("a");a.href=e,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e),showNotification(`Downloaded as ${n}!`)}function showNotification(e){let t=document.getElementById("notification");t.textContent=e,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},2500)}let countryMap={1:"United States",4:"United States",5:"United States",2:"Canada",3:"Mexico",J:"Japan",K:"South Korea",L:"China",S:"United Kingdom",V:"France/Spain",W:"Germany",Y:"Sweden/Finland",Z:"Italy"},manufacturerMap={"1F":"Ford","1G":"General Motors","1H":"Honda","1N":"Nissan","1C":"Chrysler","1L":"Lincoln","1M":"Mercury","2F":"Ford Canada","2G":"General Motors Canada","2H":"Honda Canada","3F":"Ford Mexico","3G":"General Motors Mexico","3H":"Honda Mexico",JH:"Honda Japan",JT:"Toyota",JN:"Nissan Japan",JM:"Mazda",KM:"Hyundai",KN:"Kia",WA:"Audi",WB:"BMW",WV:"Volkswagen",WP:"Porsche",WD:"Mercedes-Benz",YV:"Volvo",ZA:"Fiat",ZF:"Ferrari",ZL:"Lamborghini"},yearMap={A:1980,A:2010,B:1981,B:2011,C:1982,C:2012,D:1983,D:2013,E:1984,E:2014,F:1985,F:2015,G:1986,G:2016,H:1987,H:2017,J:1988,J:2018,K:1989,K:2019,L:1990,L:2020,M:1991,M:2021,N:1992,N:2022,P:1993,P:2023,R:1994,R:2024,S:1995,S:2025,T:1996,V:1997,W:1998,X:1999,Y:2e3,1:2001,2:2002,3:2003,4:2004,5:2005,6:2006,7:2007,8:2008,9:2009};function transliterateChar(e){return{A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9}[e]||0}function validateCheckDigit(t){var n=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let o=0;for(let e=0;e<17;e++)o+=transliterateChar(t[e])*n[e];var e=o%11;return(10===e?"X":e.toString())===t[8]}function getCountry(e){e=e[0];return countryMap[e]||"Unknown"}function getManufacturer(e){e=e.substring(0,2);return manufacturerMap[e]||"Unknown"}function getModelYear(e){e=e[9];return yearMap[e]&&yearMap[e]<=2009?yearMap[e]:"A"<=e&&e<="Y"?2010+(e.charCodeAt(0)-"A".charCodeAt(0)):"1"<=e&&e<="9"?2001+parseInt(e)-1:"Unknown"}function decodeVIN(){var e,t,n,o,a,i,r=document.getElementById("vinInput").value.toUpperCase().trim();17===r.length&&/^[A-HJ-NPR-Z0-9]{17}$/.test(r)?(e=validateCheckDigit(r),t=getCountry(r),n=getManufacturer(r),o=getModelYear(r),a=r[10],i=r.substring(11,17),document.getElementById("decodedVin").textContent=r,document.getElementById("checkDigitStatus").textContent=e?"✓ Valid":"✗ Invalid",document.getElementById("checkDigitStatus").style.color=e?"#38ef7d":"#f45c43",document.getElementById("country").textContent=t,document.getElementById("manufacturer").textContent=n,document.getElementById("modelYear").textContent=o,document.getElementById("plantCode").textContent=a,document.getElementById("serialNumber").textContent=i,document.getElementById("decodeResult").style.display="block",gtag("event","vin_decoded",{event_category:"Tool Usage",event_label:"VIN Decoder",value:1})):document.getElementById("decodeResult").style.display="none"}function clearDecoder(){document.getElementById("vinInput").value="",document.getElementById("decodeResult").style.display="none"}function transliterateCharValidator(e){return{A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9}[e]||0}function calculateExpectedCheckDigit(t){var n=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let o=0;for(let e=0;e<17;e++)o+=transliterateCharValidator(t[e])*n[e];var e=o%11;return 10===e?"X":e.toString()}function validateVIN(){var t=document.getElementById("vinValidateInput").value.toUpperCase().trim(),n=document.getElementById("validationResult"),o=document.getElementById("validationDetails");if(n.innerHTML="",0===t.length)o.style.display="none";else{let e=!0;var a=[],i=17===t.length,r=(document.getElementById("lengthCheck").textContent=i?"✓ Valid (17 characters)":"✗ Invalid (must be 17 characters)",document.getElementById("lengthCheck").style.color=i?"#38ef7d":"#f45c43",i||(e=!1,a.push("VIN must be exactly 17 characters")),/^[A-HJ-NPR-Z0-9]*$/.test(t));document.getElementById("characterCheck").textContent=r?"✓ Valid characters":"✗ Invalid characters (I, O, Q not allowed)",document.getElementById("characterCheck").style.color=r?"#38ef7d":"#f45c43",r||(e=!1,a.push("VIN contains invalid characters (I, O, Q are not allowed)"));i&&r?(t=(i=calculateExpectedCheckDigit(t))===(r=t[8]),document.getElementById("checkDigitCheck").textContent=t?"✓ Valid":"✗ Invalid",document.getElementById("checkDigitCheck").style.color=t?"#38ef7d":"#f45c43",document.getElementById("expectedCheckDigit").textContent=i,document.getElementById("actualCheckDigit").textContent=r,t||(e=!1,a.push(`Check digit mismatch (expected ${i}, got ${r})`))):(document.getElementById("checkDigitCheck").textContent="N/A",document.getElementById("checkDigitCheck").style.color="#718096",document.getElementById("expectedCheckDigit").textContent="N/A",document.getElementById("actualCheckDigit").textContent="N/A"),e?n.innerHTML='<div class="validation-result valid">✓ Valid VIN</div>':(t='<div class="validation-result invalid">✗ Invalid VIN<br><br>'+a.join("<br>")+"</div>",n.innerHTML=t),o.style.display="block",gtag("event","vin_validated",{event_category:"Tool Usage",event_label:"VIN Validator",value:1})}}function clearValidator(){document.getElementById("vinValidateInput").value="",document.getElementById("validationResult").innerHTML="",document.getElementById("validationDetails").style.display="none"}let qrCodeInstance=null;function generateQRCode(){var e=document.getElementById("vinQrInput").value.toUpperCase().trim(),t=parseInt(document.getElementById("qrSize").value);let n=document.getElementById("qrResult");var o=document.getElementById("qrCanvas"),a=document.getElementById("qrVinDisplay");if(gtag("event","qr_generated",{event_category:"Tool Usage",event_label:"VIN QR Generator",value:1}),0===e.length)showNotification("Please enter a VIN number","error");else if(17!==e.length)showNotification("VIN must be exactly 17 characters","error");else if(/^[A-HJ-NPR-Z0-9]{17}$/.test(e)){o.innerHTML="";try{qrCodeInstance=new QRCode(o,{text:e,width:t,height:t,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M}),a.textContent="VIN: "+e,n.style.display="block",showNotification("QR code generated successfully!","success"),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}catch(e){showNotification("Error generating QR code","error"),console.error(e)}}else showNotification("Invalid VIN format (I, O, Q not allowed)","error")}function clearQRCode(){var e=document.getElementById("vinQrInput"),t=document.getElementById("qrResult"),n=document.getElementById("qrCanvas");e.value="",n.innerHTML="",t.style.display="none",qrCodeInstance=null}function downloadQRCode(){var e=document.getElementById("qrCanvas").querySelector("canvas");let n=document.getElementById("vinQrInput").value.toUpperCase().trim();if(e)try{e.toBlob(function(e){var e=URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download=`VIN-QR-${n}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),showNotification("QR code downloaded!","success")})}catch(e){showNotification("Error downloading QR code","error"),console.error(e)}else showNotification("Please generate a QR code first","error")}function printQRCode(){var e=document.getElementById("qrCanvas").querySelector("canvas"),t=document.getElementById("vinQrInput").value.toUpperCase().trim();if(e)try{var n=window.open("","_blank"),o=e.toDataURL("image/png");n.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Print VIN QR Code</title>
        <style>
          body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: Arial, sans-serif;
          }
          img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 10px;
          }
          .vin-text {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
          }
          @media print {
            body {
              margin: 0;
            }
          }
        </style>
      </head>
      <body>
        <img src="${o}" alt="VIN QR Code">
        <div class="vin-text">VIN: ${t}</div>
        <script>
          window.onload = function() {
            window.print();
            setTimeout(function() {
              window.close();
            }, 100);
          };
        </script>
      </body>
      </html>
    `),n.document.close()}catch(e){showNotification("Error printing QR code","error"),console.error(e)}else showNotification("Please generate a QR code first","error")}function showNotification(e,t){let n=document.getElementById("notification");n&&(n.textContent=e,n.classList.add("show"),n.style.background="error"===t?"linear-gradient(135deg, #eb3349 0%, #f45c43 100%)":"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",setTimeout(()=>{n.classList.remove("show")},2500))}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("vinQrInput");e&&e.addEventListener("keypress",function(e){"Enter"===e.key&&generateQRCode()})});let vinStructure=[{section:"country",positions:[0],label:"Country of\nmanufacture",hasTopBox:!1,hasBottomBox:!0,topColor:null,bottomColor:"#4CAF50"},{section:"wmi",positions:[1],label:"Vehicle\nmanufacturer",hasTopBox:!0,hasBottomBox:!1,topColor:"#FF5722",bottomColor:null},{section:"type",positions:[2],label:"Vehicle type\nor division",hasTopBox:!1,hasBottomBox:!0,topColor:null,bottomColor:"#F44336"},{section:"vds",positions:[3,4,5,6,7],label:"Vehicle's brand, body style,\nengine size and type,\nmodel, series, etc.",hasTopBox:!0,hasBottomBox:!1,topColor:"#2196F3",bottomColor:null},{section:"check",positions:[8],label:"Security\ncheck digit",hasTopBox:!1,hasBottomBox:!0,topColor:null,bottomColor:"#c7b410"},{section:"year",positions:[9],label:"Model year",hasTopBox:!0,hasBottomBox:!1,topColor:"#009688",bottomColor:null},{section:"plant",positions:[10],label:"Assembly\nplant",hasTopBox:!1,hasBottomBox:!0,topColor:null,bottomColor:"#3F51B5"},{section:"serial",positions:[11,12,13,14,15,16],label:"Vehicle's production\nnumber (serial number)",hasTopBox:!0,hasBottomBox:!1,topColor:"#9C27B0",bottomColor:null}];function visualizeVIN(){let i=document.getElementById("vinInput").value.toUpperCase().trim();if(gtag("event","vin_visualizer",{event_category:"Tool Usage",event_label:"VIN Breakdown Visualizer",value:1}),0===i.length)window.showNotification&&window.showNotification("Please enter a VIN number","error");else if(17!==i.length)window.showNotification&&window.showNotification("VIN must be exactly 17 characters","error");else if(/^[A-HJ-NPR-Z0-9]{17}$/.test(i)){let a=0;var t=vinStructure.map(e=>{let n=a;var t=60*e.positions.length+8*(e.positions.length-1),o=n+t/2;return a+=30+t,{...e,startX:n,width:t,centerX:o,chars:e.positions.map((e,t)=>({char:i[e],x:n+68*t,position:e}))}}),o=a-30;var r=Math.max(100+o,1200);let e=(r-o)/2,n=(d3.select("#vinVisualization").selectAll("*").remove(),d3.select("#vinVisualization").append("svg").attr("id","vinSvg").attr("width",r).attr("height",800).attr("viewBox",`0 0 ${r} 800`).attr("preserveAspectRatio","xMidYMid meet"));t.forEach(o=>{let a=n.append("g").attr("class","group-"+o.section).attr("transform",`translate(${e}, 0)`);if(o.hasTopBox){a.append("line").attr("class","connecting-line").attr("x1",o.centerX).attr("y1",260).attr("x2",o.centerX).attr("y2",352).attr("stroke",o.topColor);var t=Math.min(Math.max(o.width,120),200);let n=a.append("g").attr("class","info-box").attr("data-section",o.section).style("cursor","pointer"),e=(n.append("rect").attr("class","info-box-rect").attr("x",o.centerX-t/2).attr("y",180).attr("width",t).attr("height",80).attr("rx",10).attr("fill",o.topColor),o.label.split("\n").forEach((e,t)=>{n.append("text").attr("class","info-box-label").attr("x",o.centerX).attr("y",195+12*t).attr("text-anchor","middle").text(e)}),"");"wmi"===o.section?e=i[1]:"vds"===o.section?e=i.substring(3,8):"year"===o.section?(t=window.yearMap?window.yearMap[i[9]]:null,e=t?t[0]+"/"+t[1]:i[9]):"serial"===o.section&&(e=i.substring(10,17)),n.append("text").attr("class","info-box-value").attr("x",o.centerX).attr("y",245).attr("text-anchor","middle").text(e),a.append("line").attr("class","underline").attr("x1",o.startX).attr("y1",352).attr("x2",o.startX+o.width).attr("y2",352).attr("stroke",o.topColor)}if(o.hasBottomBox){a.append("line").attr("class","connecting-line").attr("x1",o.centerX).attr("y1",448).attr("x2",o.centerX).attr("y2",540).attr("stroke",o.bottomColor);t=Math.min(Math.max(o.width,120),180);let n=a.append("g").attr("class","info-box").attr("data-section",o.section).style("cursor","pointer"),e=(n.append("rect").attr("class","info-box-rect").attr("x",o.centerX-t/2).attr("y",540).attr("width",t).attr("height",80).attr("rx",10).attr("fill",o.bottomColor),o.label.split("\n").forEach((e,t)=>{n.append("text").attr("class","info-box-label").attr("x",o.centerX).attr("y",555+12*t).attr("text-anchor","middle").text(e)}),"");"country"===o.section?e=window.countryMap?window.countryMap[i[0]]||"Unknown":i[0]:"type"===o.section?e="Type: "+i[2]:"check"===o.section?e=i[8]:"plant"===o.section&&(e=i[10]),n.append("text").attr("class","info-box-value").attr("x",o.centerX).attr("y",605).attr("text-anchor","middle").text(e),a.append("line").attr("class","underline").attr("x1",o.startX).attr("y1",448).attr("x2",o.startX+o.width).attr("y2",448).attr("stroke",o.bottomColor)}o.chars.forEach(e=>{var t=a.append("g").attr("class","vin-char-group").attr("data-section",o.section).style("cursor","pointer");t.append("rect").attr("class","vin-char-rect").attr("x",e.x).attr("y",360).attr("width",60).attr("height",80).attr("rx",4).attr("fill","#333"),t.append("text").attr("class","vin-char-text").attr("x",e.x+30).attr("y",412).attr("text-anchor","middle").text(e.char)})}),n.selectAll(".info-box, .vin-char-group").on("mouseenter",function(){var e=d3.select(this).attr("data-section");n.selectAll(`[data-section="${e}"]`).classed("highlight",!0)}).on("mouseleave",function(){n.selectAll(".highlight").classed("highlight",!1)}),document.getElementById("vinVisualization").style.display="block",window.showNotification&&window.showNotification("VIN visualization complete!","success"),setTimeout(()=>{document.getElementById("vinVisualization").scrollIntoView({behavior:"smooth"})},100)}else window.showNotification&&window.showNotification("Invalid VIN format (I, O, Q not allowed)","error")}function clearVisualization(){document.getElementById("vinInput").value="";var e=document.getElementById("vinVisualization");e&&(e.style.display="none"),d3.select("#vinVisualization").selectAll("*").remove()}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("vinInput");e&&e.addEventListener("keypress",function(e){"Enter"===e.key&&visualizeVIN()})});